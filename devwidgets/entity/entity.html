<!-- CSS -->
<link rel="stylesheet" type="text/css" href="/devwidgets/entity/css/entity.css" />

<div id="entity_container"><span style="display:none;">__MSG__IE_PLACEHOLDER__</span></div>

<div id="entity_user_template" style="display:none"><!--
    <div id="entity_actions">
        {if !anon}
            {if type != "user_anon" && type != "user_me"}
                {if type == "user_other"}
                    <button id="entity_user_add_to_contacts" class="s3d-button s3d-button-link-2-state sakai_addtocontacts_overlay" sakai-entityid="${data.userid}" sakai-entityname="${data.displayName}" type="button">
                        <span class="s3d-button-inner s3d-button-link-2-state-inner">__MSG__ADD_TO_CONTACTS__<span class="entity_add_to_contacts_icon entity_user_action_icon"></span></span>
                    </button>
                {elseif type == "contact_invited"}
                    <button id="entity_user_accept_invitation" class="s3d-button s3d-button-link-2-state" type="button">
                        <span class="s3d-button-inner s3d-button-link-2-state-inner">__MSG__ACCEPT_INVITATION__<span class="entity_add_to_contacts_icon entity_user_action_icon"></span></span>
                    </button>
                {elseif type == "contact_pending"}
                    <button class="entity_user_contact_pending" type="button">
                        <span class="entity_user_contact_pending_inner">__MSG__CONTACT_INVITATION_SENT__<span class="entity_add_to_contacts_requested_icon entity_user_action_icon"></div></span>
                    </button>
                {/if}
                <button id="entity_user_message" class="s3d-button s3d-button-link-2-state sakai_sendmessage_overlay" type="button" sakai-entityid="${data.userid}" sakai-entityname="${data.displayName}" sakai-entitytype="user">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">__MSG__MESSAGE__<span class="entity_message_icon entity_user_action_icon"></span></span>
                </button>
            {/if}
        {/if}
    </div>
    {if type && type == "user_me"}
        <div id="entity_user_image" class="s3d-dropdown-menu">
            <div class="entity_profilepic_internal">
                <img id="entity_profile_picture" src="{if data.picture}${data.picture}{else}/devwidgets/entity/images/entity_default_user.png{/if}"/>
            </div>
            <div class="s3d-dropdown-menu-arrow"></div>
            <div class="s3d-dropdown-container" style="display:none;">
                <ul>
                    <li><a id="changepic_container_trigger" href="javascript:;" class="s3d-bold">__MSG__CHANGE_PICTURE__</a></li>
                </ul>
            </div>
        </div>
        <div class="s3d-bold entity_name_me">${data.displayName}</div>
    {else}
        <div id="entity_user_image" class="entity_other_profilepic">
            <div class="entity_profilepic_internal">
                <img id="entity_profile_picture" src="{if data.picture}${data.picture}{else}/devwidgets/entity/images/entity_default_user.png{/if}"/>
            </div>
        </div>
        <div id="entity_name" class="s3d-bold">${data.displayName}</div>
        <div id="entity_owns" class="s3d-regular-links">
            <span class="entity_number">(${data.counts["content"]})</span> <a href="#l=library" title="${data.counts["content"]} Documents">Documents</a>,
            <span class="entity_number">(${data.counts["memberships"]})</span> <a href="#l=memberships" title="${data.counts["memberships"]} Memberships">Memberships</a>,
            <span class="entity_number">(${data.counts["contacts"]})</span> <a href="#l=contacts" title="${data.counts["contacts"]} Contacts">Contacts</a>
        </div>
    {/if}
--></div>

<div id="entity_newaccount_template" style="display:none"><!--
    <div class="s3d-bold entity_plaintitle">Create new account</div>
--></div>

<div id="entity_acknowledgements_template" style="display:none"><!--
    <div class="s3d-bold entity_plaintitle">Acknowledgements</div>
--></div>

<div id="entity_search_template" style="display:none"><!--
    <div class="s3d-bold entity_plaintitle">Search</div>
--></div>

<div id="entity_directory_template" style="display:none"><!--
    <div id="entity_directory_image" class="entity_directory_image">
        {if data.icon}
            <img src="${data.icon}"/>
        {else}
            <img src="/dev/images/hierarchy.png"/>
        {/if}
    </div>
    <div id="entity_name" class="s3d-bold entity_plaintitle">${data.title}</div>
--></div>

<div id="entity_content_template" style="display:none"><!--
    <div id="entity_actions">
        {if !anon}
            {if type && type == "content_managed"}
                <button id="entity_content_permissions" class="s3d-button s3d-button-link-2-state" type="button">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">__MSG__PERMISSIONS__<span class="entity_content_permissions_icon"></span></span>
                </button>
            {/if}
            <button id="entity_content_save" class="s3d-button s3d-button-link-2-state savecontent_trigger" data-entityid="${data.data["jcr:name"]}" type="button">
                <span class="s3d-button-inner s3d-button-link-2-state-inner">
                    __MSG__ADD_TO_LIBRARY__<span class="entity_add_to_library"></span>
                </span>
            </button>
            <button id="entity_content_share" class="s3d-button s3d-button-link-2-state" type="button">
                <span class="s3d-button-inner s3d-button-link-2-state-inner">
                    __MSG__SHARE__<span class="entity_share_content"></span>
                </span>
            </button>
            {if data.data.mimeType === "x-sakai/link"}
                <a id="contentpreview_download_button" href="${data.data["sakai:pooled-content-url"]}" class="s3d-button s3d-button-link-2-state fl-force-right s3d-margin-top-5" target="_blank">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">Open Link<span class="entity_download_content"></span></span>
                </a>
            {elseif data.data.mimeType !== "x-sakai/document"}
                <a id="contentpreview_download_button" href="${data.path}" class="s3d-button s3d-button-link-2-state fl-force-right s3d-margin-top-5" target="_blank">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">Download<span class="entity_download_content"></span></span>
                </a>
            {/if}
        {/if}
    </div>
    <div id="entity_content_image" class="entity_content_image">
        {if data.isManager}
            <div id="entity_managed_content"></div>
        {/if}
        <img src="${data.data['iconURL']}"/>
    </div>
    <span id="entity_name" {if data.isManager}class="s3d-bold contentmetadata_editable"{/if}>${data.data["sakai:pooled-content-file-name"]}</span>
    <span id="entity_name_edit" style="display:none">
        <input id="entity_name_text" type="text" />
    </span>
    <div id="entity_owns" class="s3d-regular-links">
        {var peopleCount = data.members.counts.people}
        <span class="entity_number">
            <div id="entity_used_by_icon" class="entity_content_details_icon"></div>
            Used by (<a href="#" title="${peopleCount}
            {if peopleCount == 1} __MSG__PERSON__{else} __MSG__PEOPLE__{/if}"
            class="entity_content_people">${peopleCount}</a>)
        </span>
        <a href="#" title="${peopleCount}
        {if peopleCount == 1} __MSG__PERSON__{else} __MSG__PEOPLE__{/if}"
        class="entity_content_people">
        {if peopleCount == 1}__MSG__PERSON__{else}__MSG__PEOPLE__{/if}</a> and
        {var groupCount = data.members.counts.groups}
        <span class="entity_number">
            ({if groupCount}<a href="#" title="${groupCount}
            {if groupCount == 1} __MSG__GROUP__{else} __MSG__GROUPS__{/if}"
            class="entity_content_group">${groupCount}</a>{else}<span title="0 __MSG__GROUPS__">0</span>{/if})
        </span>
        {if groupCount}
            <a href="#" title="${groupCount}
                {if groupCount == 1} __MSG__GROUP__{else} __MSG__GROUPS__{/if}"
                class="entity_content_group">
                {if groupCount == 1} __MSG__GROUP__{else} __MSG__GROUPS__{/if}
            </a>
        {else}
            <span title="0 __MSG__GROUPS__">__MSG__GROUPS__</span>
        {/if}
        <span class="entity_comments">
            <img src="/devwidgets/entity/images/entity_comment_icon.png" alt="comments-icon" />
            {var commentCount = sakai.api.Content.getCommentCount(data.data)}
            <a id="entity_comments_link" href="#">${commentCount} {if commentCount == 1} __MSG__COMMENT__{else} __MSG__COMMENTS__{/if}</a>
        </span>
        <span class="entity_number entity_permissions_label">
            {var permissions = data.data["sakai:permissions"]}
            <div id="entity_${permissions}_privacy_icon" class="entity_content_details_icon"></div>
            {if permissions == "public"}
                __MSG__VISIBLE_TO_ANYONE__
            {elseif permissions == "everyone"}
                __MSG__VISIBLE_TO_LOGGED__
            {else}
                {var firstuser = data.members.managers[0].basic.elements}
                __MSG__PRIVATE_TO__ ${firstuser.firstName.value} ${firstuser.lastName.value}
                {if (peopleCount + groupCount) > 1}
                    + ${groupCount + peopleCount - 1} __MSG__OTHERS__
                {/if}
            {/if}
        </span>
    </div>
--></div>

<div id="entity_group_template" style="display:none"><!--
    <div id="entity_actions">
        {if !anon}
            {if type === "group_managemode"}
                <button id="entity_group_back" class="s3d-button s3d-button-link-2-state" type="button">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">Back to pages</span>
                </button>
            {else}
                <button id="entity_message" class="s3d-button s3d-button-link-2-state" type="button">
                    <span class="s3d-button-inner s3d-button-link-2-state-inner">
                        Message<span class="entity_message_icon entity_user_action_icon"></span>
                    </span>
                </button>
                {if type === "group_managed"}
                    <button id="entity_manage_group" class="s3d-button s3d-button-link-2-state" type="button">
                        <span class="s3d-button-inner s3d-button-link-2-state-inner">Manage group</span>
                    </button>
                {/if}
            {/if}
        {/if}
    </div>
    <div id="entity_group_image" class="entity_group_image {if type && type == "group_managed"} entity_user_image_pointer{/if} "></div>
    <div id="entity_name" class="s3d-bold">${data.authprofile["sakai:group-title"]}</div>
    <div id="entity_owns" class="s3d-regular-links">
        <span class="entity_number">(1)</span> <a href="#l=library" title="1 Documents">Documents</a>,
        <span class="entity_number">(2)</span> <a href="#l=memberships" title="(2) Participants">Participants</a>
    </div>
    {if type && type == "group_managed"}
        <div class="entity_user_picture_dropdown entity_user_dropdown" style="display:none;">
            <div class="entity_dropdown_content s3d-dropdown-menu">
                <ul>
                    <li><a href="#" class="s3d-bold">__MSG__CHANGE_PICTURE__</a></li>
                </ul>
            </div>
        </div>
    {/if}
--></div>

<!-- DIALOG BOX FOR CONTENT PROFILE USERS -->
<div id="entity_content_users_dialog" class="dialog" style="width:500px; margin-left: -200px">
    <div class="dialog_header">
        <div class="dialog_header_inner">
            <h1 id="entity_content_users_dialog_heading"><!-- --></h1>
            <button type="button" class="jqmClose dialog_close_image s3d-link-button s3d-action" title="__MSG__CLOSE_DIALOG__">__MSG__CLOSE_DIALOG__</button>
        </div>
    </div>

    <div class="dialog_content">
        <!-- CONTAINER -->
        <div id="entity_content_users_dialog_list_container"><!-- --></div>

        <!-- TEMPLATE -->
        <div id="entity_content_users_dialog_list_template" style="display:none;"><!--
            <ul class="entity_content_users_dialog_list">
                {var userlist_groups_index = 0}
                {var userlist_people_index = 0}
                {for i in userList}
                    {if i['sakai:group-id'] && type === "groups"}
                        ${userlist_groups_index++|eat}
                        {if userlist_groups_index%2} <li id="${i['sakai:group-id']}">
                        {else} <li id="${i['sakai:group-id']}" class="entity_content_even">
                        {/if}
                        {if i.pictureUrl}
                            <a href="/~${i['sakai:group-id']}" target="_blank"><img src="${i.pictureUrl}" alt="__MSG__GROUP_PICTURE_FOR__ ${i['sakai:group-title']}" class="entity_content_picture"/></a>
                        {else}
                            <a href="/~${i['sakai:group-id']}" target="_blank"><img src="/dev/images/group_avatar_icon_32x32.png" alt="__MSG__DEFAULT_GROUP_PICTURE__" class="entity_content_picture"/></a>
                        {/if}
                        <span class="entity_content_name">
                            <a class="s3d-regular-links s3d-bold" href="/~${i['sakai:group-id']}" target="_blank">${i['sakai:group-title']}</a>
                        </span>
                        </li>
                    {elseif i["rep:userId"] && type === "people"}
                        ${userlist_people_index++|eat}
                        {var displayName = unescape(sakai.api.User.getDisplayName(i))}
                        {if !displayName}
                            {var displayName = i.displayName}
                        {/if}
                        {if userlist_people_index%2} <li id="${i["rep:userId"]}">
                        {else} <li id="${i["rep:userId"]}" class="entity_content_even">
                        {/if}
                        {if i.pictureUrl}
                            <a href="/~${i["rep:userId"]}" target="_blank"><img src="${i.pictureUrl}" alt="__MSG__PROFILE_PICTURE_FOR__ ${displayName}" class="entity_content_picture"/></a>
                        {else}
                            <a href="/~${i["rep:userId"]}" target="_blank"><img src="/dev/images/user_avatar_icon_32x32.png" alt="__MSG__DEFAULT_PROFILE_PICTURE__" class="entity_content_picture"/></a>
                        {/if}
                        <span class="entity_content_name">
                            <a class="s3d-regular-links s3d-bold" href="/~${i["rep:userId"]}" target="_blank">${displayName}</a>
                        </span>
                        </li>
                    {/if}
                {/for}
                {if type === "groups" && userlist_groups_index === 0}
                    <div class="entity_content_list_empty">
                        __MSG__NO_GROUPS_USING_CONTENT__
                    </div>
                {/if}
            </ul>
            --></div>

        <div class="dialog_buttons fl-force-right">
            <button type="button" class="s3d-button s3d-button-primary jqmClose"><span class="s3d-button-inner">__MSG__CLOSE__</span></button>
        </div>
        <hr class="fl-push fl-hidden">
    </div>

    <!-- DIALOG FOOTER -->
    <div class="dialog_footer">
        <div class="dialog_footer_inner"><!-- --></div>
    </div>
</div>

<!-- i18n MESSAGES -->
<div id="entity_notifications" style="display:none">
    <span id="entity_content_groups">__MSG__THE_FOLLOWING_GROUPS_USING_CONTENT__</span>
    <span id="entity_content_people">__MSG__THE_FOLLOWING_PEOPLE_USING_CONTENT__</span>
</div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="/devwidgets/entity/javascript/entity.js"></script>
