<link rel="stylesheet" type="text/css" href="/devwidgets/topnavigation/css/topnavigation.css"/>

<div id="topnavigation_container">
    <div id="topnavigation_scroll_to_top_container">
        <button type="button" class="s3d-link-button" id="topnavigation_scroll_to_top" title="__MSG__SCROLL_TO_TOP__" accesskey="s" style="display:none;"></button>
    </div>
    <ul class="topnavigation_explore" role="menubar"><!----></ul>
    <div class="topnavigation_right">
        <div class="topnavigation_search s3d-search-container">
            <input type="text" tabindex_none="40" id="topnavigation_search_input" title="__MSG__SEARCH_FOR__" class="s3d-search-inputfield"/>
            <button type="button" class="s3d-button s3d-overlay-button s3d-search-button">
                <img src="/dev/images/search_icon.png" alt="__MSG__SEARCH_FOR__"/>
            </button>
            <div id="topnavigation_search_results" style="display:none;">
                <div id="topnavigation_search_results_container" role="menu"><!----></div>
                <div id="topnavigation_search_results_bottom_container"><!----></div>
            </div>
        </div>
        <div class="topnavigation_user_container"></div>
    </div>
</div>

<div id="navigation_template" style="display:none"><!--
    {macro appendInfo(type)}
        {if type === "messages"}
            <div id="topnavigation_user_messages_container" class="topnavigation_counts_container">
                <div class="topnavigation_usersection_splitter">|</div>
                <div class="topnavigation_menuitem_counts_container" id="topnavigation_messages_container">
                    <div id="topnavigation_user_inbox_icon" class="topnavigation_menuitem_icon"></div>
                    <div id="topnavigation_user_inbox_messages" class="topnavigation_menuitem_counts s3d-bold"></div>
                </div>
                <div class="s3d-dropdown-menu" style="display:none;"></div>
            </div>
        {elseif type === "collections"}
            <div id="topnavigation_user_collections_container" class="topnavigation_counts_container">
                <div class="topnavigation_usersection_splitter">|</div>
                <div class="topnavigation_menuitem_counts_container collector_toggle">
                    <div id="topnavigation_user_collections_icon" class="topnavigation_menuitem_icon"></div>
                    <div id="topnavigation_user_collections_total" class="topnavigation_menuitem_counts s3d-bold">${"" + sakai.api.Content.Collections.getMyCollectionsCount()}</div>
                </div>
            </div>
        {/if}
    {/macro}

    {for i in links}
        <li class="s3d-bold s3d-dropdown-menu{if i.subnav} hassubnav{/if}">
            <a role="menuitem" aria-haspopup="true" class="s3d-bold" {if i.id}id="${i.id}" {/if} href="${i.url}">${i.label}</a>
            <div id="${i.id}_dropdown" class="s3d-dropdown-container" style="display:none;">
                {if i.subnav}
                    <ul role="menu" aria-hidden="true">
                        {for subnav in i.subnav}
                            {if subnav !== "hr"}
                            <li>
                                <a role="menuitem" tabindex="-1" href="${subnav.url}" id="${subnav.id}" class="s3d-bold">${subnav.label}</a>
                            </li>
                            {else}
                                <hr class="s3d-split-line"/>
                            {/if}
                        {/for}
                    </ul>
                {/if}
            </div>
        </li>
        {if i.append}${appendInfo(i.append)}{/if}
    {/for}
--></div>

<div id="topnavigation_messages_dropdown_template"><!--
    <div class="dropdown-menu-arrowup"></div>
    <div class="s3d-dropdown-container">
        {if dataPresent}
            <div class="s3d-dropdown-menu-content-container">
                <div id="topnavigation_message_profile_pic">
                    <img src="${sakai.api.User.getProfilePicture(data.results[0].from.picture)}" alt="test"/>
                </div>
                <div id="topnavigation_message_sender" class="s3d-bold">${data.results[0].from.name} <span>(${data.results[0].timeago})</span></div>
                <div id="topnavigation_message_subject" class="s3d-bold">${sakai.api.Util.applyThreeDots(data.results[0].subject, 120)}</div>
                <div id="topnavigation_message_body">${sakai.api.Util.applyThreeDots(data.results[0].body, 270, false, false, true)}</div>

                <a href="/me#l=messages/inbox&message=${data.results[0].id}&reply=true" class="s3d-button s3d-overlay-button" id="topnavigation_message_reply">Reply</a>
                <a href="/me#l=messages/inbox&message=${data.results[0].id}" class="s3d-button s3d-overlay-button" id="topnavigation_message_readfull">Read full message</a>
                <hr class="fl-hidden fl-push"/>
            {else}
                <div class="s3d-dropdown-menu-content-container no_messages">
                    <div class="s3d-no-results-container">
                        <img src="/devwidgets/topnavigation/images/topnav_messages_demo.png" alt="__MSG__MESSAGES_DEMO__" id="message_video_preview"/>
                        <div class="s3d-no-results-icon s3d-no-results-people"></div>
                        <h1>__MSG__YOUR_INBOX_IS_EMPTY__. <a class="s3d-regular-links" href="/me#l=messages/inbox&newmessage=true">__MSG__SEND_A_MESSAGE__</a> __MSG__OR__ <a class="s3d-regular-links" href="/search#l=people">__MSG__FIND_PEOPLE__</a> __MSG__TO_EXPAND_YOUR_NETWORK__.</h1>
                    </div>
            {/if}
        </div>
    </div>
--></div>

<div id="search_template" style="display:none"><!--
        {if files && files.length}
            <a href="/search#l=content&q=${query}" class="topnavigation_search_results_section_header">__MSG__CONTENT__</a>
            <ul role="menu">
               {for file in files}
                    <li>
                        <div class="topnav_content_icon_container fl-force-left">
                            <span class="topnav_content_icon ${file.css_class}"></span>
                        </div>
                        <a role="menuitem" tabindex="-1" href="${file.url}" title="${file.name|safeOutput}" class="s3d-bold">${file.dottedname}</a>
                    </li>
                    {if file_index != files.length -1}<hr class="s3d-split-line"/>{/if}
                {/for}
            </ul>
        {/if}
        {if people && people.length}
            <a href="/search#l=people&q=${query}" class="topnavigation_search_results_section_header">__MSG__PEOPLE__</a>
            <ul role="menu">
                {for person in people}
                    <li>
                        <div class="topnav_content_icon_container fl-force-left">
                            <span class="topnav_person_icon"></span>
                        </div>
                        <a role="menuitem" tabindex="-1" href="${person.url}" title="${person.name}" class="s3d-bold">${person.dottedname}</a>
                    </li>
                    {if person_index != people.length -1}<hr class="s3d-split-line"/>{/if}
                {/for}
            </ul>
        {/if}
        {for c in sakai.config.worldTemplates}
            {if groups[c.id] && groups[c.id].length}
                <a href="/search#l=${c.id}&category=${c.id}&q=${query}" class="topnavigation_search_results_section_header">${sakai.api.i18n.getValueForKey(c.title)}</a>
                <ul role="menu">
                    {for group in groups[c.id]}
                        <li>
                            <div class="topnav_content_icon_container fl-force-left">
                                <span class="${group.css_class}"></span>
                            </div>
                            <a role="menuitem" tabindex="-1" href="${group.url}" title="${group.name|safeOutput}" class="s3d-bold">${group.dottedname}</a>
                        </li>
                        {if group_index != groups.length -1}<hr class="s3d-split-line"/>{/if}
                    {/for}
                </ul>
            {/if}
        {/for}
--></div>

<div id="search_bottom_template" style="display:none;"><!--
    {if people.length || groups.length || files.length && people.length + groups.length + files.length != peopletotal + groupstotal + filestotal}
        <a href="/search#q=${query}&filter=&facet=&page=1" id="topnavigation_search_see_all">
            <button class="s3d-button s3d-overlay-button">__MSG__SEE_ALL__</button>
        </a>
    {/if}
    <span id="topnavigation_search_results_bottom_content">
        {var totalresults = 0}
        {if people.length || files.length}
            ${totalresults = peopletotal + filestotal|eat} 
        {/if}
        {for c in sakai.config.worldTemplates}
            {if groups[c.id] && groups[c.id].length}
                ${totalresults += groups[c.id + "total"]|eat} 
            {/if}
        {/for}
        {if totalresults > 0}
            ${totalresults} __MSG__RESULTS__
        {else}
            __MSG__NO_RESULTS__
        {/if}
    </span>
--></div>

<div id="topnavigation_user_template"><!--
    {if anon}
        {if auth.externalAuth}
        <ul id="subnavigation_login_list" role="menu">
            <li class="s3d-bold s3d-dropdown-menu hassubnav">
                <a role="menuitem" aria-haspopup="true" href="#" id="topnavigation_user_options_login_external" class="s3d-bold">__MSG__SIGN_IN__</a>
                <div class="topnavigation_external_login s3d-dropdown-container" style="display:none;">
                    <ul role="menu" aria-hidden="true">
                        {for i in auth.Authentication.external}
                            <li>
                                <a tabindex="-1" role="menuitem" href="${i.url}" class="s3d-bold topnavigation_external_login_link">${i.label}</a>
                            </li>
                        {/for}
                    </ul>
                </div>
            </li>
        </ul>
        {else}
        <div class="s3d-dropdown-menu" id="topnavigation_user_options_login_wrapper">
            <button id="topnavigation_user_options_login">__MSG__SIGN_IN__</button>
            <div id="topnavigation_user_options_login_fields" class="s3d-dropdown-container" style="display:none;">
                <form id="topnavigation_user_options_login_form" method="POST">
                    <div id="topnavigation_user_options_login_fields_container" class="s3d-dropdown-menu-content-container s3d-form-field-wrapper">
                        <div id="topnavigation_user_options_login_error" style="display:none;">
                            <div id="topnavigation_user_options_login_error_icon"></div>
                            <span>__MSG__INVALID_USERNAME_OR_PASSWORD__</span>
                        </div>
                        <label for="topnavigation_user_options_login_fields_username" class="s3d-input-label-above">__MSG__USERNAME__</label>
                        <input type="text" maxlength="255" id="topnavigation_user_options_login_fields_username" name="topnav_login_username" class="login-container-textfield s3d-input" />
                        <label for="topnavigation_user_options_login_fields_password" class="s3d-input-label-above">__MSG__PASSWORD__</label>
                        <input type="password" maxlength="255" id="topnavigation_user_options_login_fields_password" name="topnav_login_password" class="login-container-textfield s3d-input" />
                        <button type="button" id="topnavigation_user_options_login_forgotten" class="s3d-link-button" style="display:none;">__MSG__FORGOTTEN_YOUR_USERNAME_OR_PASSWORD__?</button>
                        <hr class="s3d-split-line fl-push"/>
                        {if auth.Authentication.allowInternalAccountCreation}
                            <span class="topnavigation_sign_up_link">__MSG__NO_ACCOUNT_YET__</span>
                            <a class="s3d-regular-links topnavigation_sign_up_link" href="/register">__MSG__SIGN_UP__</a>
                        {/if}
                        <button type="submit" class="s3d-button s3d-overlay-button" id="topnavigation_user_options_login_button_login">__MSG__SIGN_IN__</button>
                        <span id="topnavigation_user_options_login_button_signing_in" style="display:none;">__MSG__SIGNING_IN__</span>
                        <hr class="fl-push fl-hidden"/>
                    </div>
                </form>
            </div>
        </div>
        {/if}
    {else}
        <ul id="topnavigation_user_options_list" role="menu">
            <li class="s3d-bold s3d-dropdown-menu hassubnav">
                <a role="menuitem" aria-haspopup="true" href="/me#" id="topnavigation_user_options_name" class="s3d-bold"></a>
                <div class="topnavigation_user_dropdown s3d-dropdown-container" style="display:none;">
                    <ul role="menu" aria-hidden="true">
                        <li><a tabindex="-1" role="menuitem" href="#" id="subnavigation_preferences_link" class="s3d-regular-links s3d-bold">__MSG__MY_ACCOUNT__</a></li>
                        <li><a tabindex="-1" role="menuitem" href="/logout" id="subnavigation_logout_link" class="s3d-regular-links s3d-bold">__MSG__SIGN_OUT__</a></li>
                    </ul>
                </div>
            </li>
        </ul>
    {/if}
--></div>

<!-- OVERLAYS -->

<!-- Upload Content Widget Container -->
<div id="newaddcontentcontainer" style="display:none;">
    <div id="widget_newaddcontent" class="widget_inline"></div>
</div>

<!-- Send Message Widget Container -->
<div id="widget_sendmessage" class="widget_inline"></div>

<!-- Add To Contacts Widget Container -->
<div id="widget_addtocontacts" class="widget_inline"></div>

<!-- Join Group Widget Container -->
<div id="widget_joingroup" class="widget_inline"></div>

<!-- Join Request Buttons Widget Container -->
<div id="widget_joinrequestbuttons" class="widget_inline"></div>

<!-- Tooltip Widget Container -->
<div id="widget_tooltip" class="widget_inline"></div>

<!-- My Preferences Widget Container -->
<div id="widget_accountpreferences" class="widget_inline"></div>

<!-- Change Picture Widget Container -->
<div id="widget_changepic" class="widget_inline"></div>

<!-- Save Content Widget Container -->
<div id="widget_savecontent" class="widget_inline"></div>

<!-- Add People and Groups Widget Container -->
<div id="widget_addpeoplegroups" class="widget_inline"></div>

<!-- Share Content Widget Container -->
<div id="widget_newsharecontent" class="widget_inline"></div>

<!-- Personinfo Widget Container -->
<div id="widget_personinfo" class="widget_inline"></div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="/devwidgets/topnavigation/javascript/topnavigation.js"></script>
