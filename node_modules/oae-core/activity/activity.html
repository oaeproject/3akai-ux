<!-- CSS -->
<link rel="stylesheet" type="text/css" href="css/activity.css" />

<div class="activity-widget">
    <div class="oae-list-options">
        <div>
            <button class="btn oae-list-options-toggle">
                <h2>__MSG__RECENT_ACTIVITY__</h2>
            </button>
        </div>
    </div>
    <ul class="oae-list"><!-- --></ul>
</div>

<div id="activity-noresults-template"><!--
    <div class="alert alert-info">
        __MSG__NO_ACTIVITIES_OCCURRED_YET__
    </div>
--></div>

<div id="activity-items-template"><!--
    {macro renderSummary(activity)}
        {if activity.actor['oae:collection']}
            {var actor1Obj = activity.actor['oae:collection'][0]}
        {else}
            {var actor1Obj = activity.actor}
        {/if}

        <div class="activity-summary-container clearfix">
            <div class="pull-left activity-entity-thumbnail">
                ${renderThumbnail(actor1Obj)}
            </div>
            <div class="activity-summary">
                ${renderActivitySummary(activity)}
                <small class="muted">${oae.api.l10n.timeAgo(activity.published)}</small>
            </div>
        </div>
    {/macro}

    {macro renderPreview(activity)}
        <div class="activity-preview-container clearfix">
            {var previewObj = activity.target || activity.object}
            {if activity.target && (activity.target.objectType === 'collection' || activity.target.objectType === 'content')}
                {var previewObj = activity.target}
            {elseif activity.object.objectType === 'collection'}
                {var previewObj = activity.object}
            {elseif activity.actor.objectType === 'collection' && activity.object.objectType !== 'content'}
                {var previewObj = activity.actor}
            {elseif activity.target && activity.target.objectType === 'content'}
                {var previewObj = activity.target}
            {elseif activity.object && activity.object.objectType === 'content'}
                {var previewObj = activity.object}
            {/if}

            {if previewObj['oae:id'] === context}
                {if activity.target}
                    {var previewObj = activity.object}
                {else}
                    {var previewObj = activity.actor}
                {/if}
            {/if}

            {if previewObj['oae:wideImage']}
                <ul class="row oae-list oae-list-grid activity-wide">
                    ${listItem(previewObj, null, false, previewObj['oae:wideImage'].url)}
                </ul>
            {else}
                {if previewObj.objectType === 'collection'}
                    {var count = previewObj['oae:collection'].length}
                    {if count <= 3}
                        {var largePreviews = previewObj['oae:collection'].slice(0, 3)}
                    {else}
                        {var largePreviews = previewObj['oae:collection'].slice(0, 2)}
                        {var smallPreviews = previewObj['oae:collection'].slice(2, 14)}
                    {/if}
                {else}
                    {var largePreviews = [previewObj]}
                {/if}

                <ul class="row oae-list oae-list-grid">
                    {for largePreview in largePreviews}
                        ${listItem(largePreview, null, false)}
                    {/for}
                    {if smallPreviews}
                        <li>
                            <div class="oae-tile activity-multiple">
                                {for smallPreview in smallPreviews}
                                    ${renderThumbnail(smallPreview, false)}
                                {/for}
                                {if count > 14}
                                    {var x = count - 14}
                                    <div class="oae-tile-metadata">__MSG__AND_X_MORE__</div>
                                {/if}
                            </div>
                        </li>
                    {/if}
                </ul>
            {/if}
        </div>
    {/macro}

    {macro renderComments(activity)}
        {if activity['oae:activityType'] === 'content-comment' || activity['oae:activityType'] === 'discussion-message'}
            <div class="activity-comment-container clearfix">
                <ul class="media-list">
                    {for comment in activity.object['oae:collection']}
                        <li class="media activity-level-${comment['oae:level']}">
                            <div class="pull-left activity-entity-thumbnail">
                                ${renderThumbnail(comment.author)}
                            </div>
                            <div class="media-body">
                                <h4 class="media-heading">
                                    {if comment.author['oae:profilePath']}
                                        <a href="${comment.author['oae:profilePath']}">${comment.author.displayName|encodeForHTML}</a>
                                    {else}
                                        ${comment.author.displayName|encodeForHTML}
                                    {/if}
                                    <small class="muted">
                                        ${oae.api.l10n.timeAgo(comment.published)}
                                    </small>
                                </h4>
                                ${oae.api.util.security().encodeForHTMLWithLinks(comment.content).replace(/\n/g, '<br/>')}
                            </div>
                        </li>
                    {/for}
                    {if !activity.object.hasAllComments}
                        <li class="media text-center">
                            <a href="${activity.target['oae:profilePath']}">__MSG__SHOW_ALL__</a>
                        </li>
                    {/if}
                </ul>
            </div>
        {/if}
    {/macro}

    {for activity in results}
        <li data-id="${activity['oae:activityId']}">
            <div class="well">
                ${renderSummary(activity)}
                ${renderPreview(activity)}
                ${renderComments(activity)}
            </div>
        </li>
    {/for}
--></div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="js/activity.js"></script>
