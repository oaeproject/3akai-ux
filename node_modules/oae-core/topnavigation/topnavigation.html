<!-- CSS -->
<link rel="stylesheet" type="text/css" href="css/topnavigation.css"/>

<div id="topnavigation-container" role="navigation" aria-label="__MSG__TOPNAV_ARIA_LABEL__">
    <!-- ACCESSIBILITY HELPERS -->
    <a id="topnavigation-skip" class="sr-only oae-skip-link hide" href="#topnavigation-target" accesskey="__MSG__SKIP_TOP_MENU_KEY__">__MSG__SKIP_TOP_MENU__</a>
    <!-- NAVIGATION -->
    <div class="row">
        <!-- LEFT MENU -->
        <div id="topnavigation-left" class="col-xs-5"><!-- --></div>
        <!-- LOGO -->
        <div id="topnavigation-institutional-logo-container" class="col-xs-2 text-center"><!-- --></div>
        <!-- RIGHT MENU -->
        <div id="topnavigation-right" class="col-xs-5 text-right">
            <!-- SEARCH FORM -->
            <form id="topnavigation-search-form" class="form-inline" role="search" aria-label="__MSG__TOPNAV_SEARCH_ARIA_LABEL__">
                <div class="form-group">
                    <label for="topnavigation-search-query" class="control-label sr-only">__MSG__SEARCH__</label>
                    <input type="text" id="topnavigation-search-query" class="search-query form-control pull-left" title="__MSG__SEARCH_FOR_CONTENT_PEOPLE_GROUPS__"/>
                    <button type="submit" id="topnavigation-search-icon" class="btn btn-link pull-left">
                        <i class="icon-search"><span class="sr-only">__MSG__SEARCH__</span></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<h1 id="topnavigation-target" class="sr-only">__MSG__SKIP_MENU_TARGET__</h1>

<div id="topnavigation-institutional-logo-template"><!--
    <a href="/" class="oae-institutional-logo hidden-xs visible-sm" title="${oae.data.me.tenant.displayName|encodeForHTMLAttribute}">
        <span class="sr-only">${oae.data.me.tenant.displayName|encodeForHTML}</span>
    </a>
    <a href="/" class="oae-institutional-logo-small visible-xs" title="${oae.data.me.tenant.displayName|encodeForHTMLAttribute}">
        <span class="sr-only">${oae.data.me.tenant.displayName|encodeForHTML}</span>
    </a>
--></div>

<!--
//////////////////////////////
// ANONYMOUS NAVIGATION BAR //
//////////////////////////////
-->

<div id="topnavigation-left-anonymous-template"><!--
    {if oae.api.config.getValue('oae-authentication', 'local', 'allowAccountCreation')}
        <button type="button" class="btn btn-link oae-trigger-register">__MSG__SIGN_UP__</button>
    {/if}
--></div>

<div id="topnavigation-right-anonymous-template"><!--
    {var hasCas = oae.api.config.getValue('oae-authentication', 'cas', 'enabled')}
    {var hasFacebook = oae.api.config.getValue('oae-authentication', 'facebook', 'enabled')}
    {var hasGoogle = oae.api.config.getValue('oae-authentication', 'google', 'enabled') && !oae.api.config.getValue('oae-authentication', 'google', 'hostedDomain')}
    {var hasGoogleApps = oae.api.config.getValue('oae-authentication', 'google', 'enabled') && oae.api.config.getValue('oae-authentication', 'google', 'hostedDomain')}
    {var hasShibboleth = oae.api.config.getValue('oae-authentication', 'shibboleth', 'enabled')}
    {var hasTwitter = oae.api.config.getValue('oae-authentication', 'twitter', 'enabled')}

    {var hasLocalAuth = oae.api.config.getValue('oae-authentication', 'local', 'enabled') ||
                        oae.api.config.getValue('oae-authentication', 'ldap', 'enabled')}
    {var hasExternalAuth = hasFacebook || hasTwitter || hasGoogle || hasGoogleApps || hasCas || hasShibboleth}

    {var hasSingleInstitutionalAuth = (_.compact([hasCas, hasShibboleth, hasGoogleApps]).length === 1) && !hasFacebook && !hasTwitter && !hasGoogle}

    {macro externalAuth(id, title, icon, configurableTitle)}
        <li>
            <form action="/api/auth/${id}" method="POST">
                <input type="hidden" name="redirectUrl" value="${redirectUrl|encodeForHTMLAttribute}" />
                <button type="submit" class="btn btn-${id}">
                    {if icon}
                        <i class="icon icon-${icon}"></i>
                    {/if}
                    {if configurableTitle}
                        {var strategyName = configurableTitle}
                        __MSG__SIGN_IN_WITH_STRATEGY__
                    {else}
                        ${title}
                    {/if}
                </button>
            </form>
        </li>
    {/macro}

    <ul class="list-inline">
        <li class="topnavigation-search-button">
            <a href="/search" class="btn btn-link" title="__MSG__SEARCH__" role="menuitem">
                <i class="icon-search"><span class="sr-only">__MSG__SEARCH__</span></i>
            </a>
        </li>
        <li class="dropdown">
            {if !hasLocalAuth && hasSingleInstitutionalAuth}
                {if hasCas}
                    {var externalUrl = '/api/auth/cas'}
                {elseif hasShibboleth}
                    {var externalUrl = '/api/auth/shibboleth'}
                {elseif hasGoogleApps}
                    {var externalUrl = '/api/auth/google'}
                {/if}

                <form action="${externalUrl}" method="POST">
                    <input type="hidden" name="redirectUrl" value="${redirectUrl|encodeForHTMLAttribute}" />
                    <button type="submit" class="btn btn-link">__MSG__SIGN_IN__</a>
                </form>
            {else}
                <button type="button" id="topnavigation-signin" class="btn btn-link dropdown-toggle" data-toggle="dropdown">__MSG__SIGN_IN__</button>

                <div id="topnavigation-signin-dropdown" class="dropdown-menu pull-right text-left {if hasLocalAuth && hasExternalAuth} topnavigation-signin-dropdown-double {else} topnavigation-signin-dropdown-single {/if}">
                    <div class="row">
                        {if hasExternalAuth}
                            <div id="topnavigation-signin-external" class="col-xs-12 {if hasLocalAuth && hasExternalAuth} col-sm-6{/if} text-center">
                                <ul class="nav">
                                    {if hasTwitter}
                                        ${externalAuth('twitter', '__MSG__SIGN_IN_WITH_TWITTER__', 'twitter')}
                                    {/if}
                                    {if hasFacebook}
                                        ${externalAuth('facebook', '__MSG__SIGN_IN_WITH_FACEBOOK__', 'facebook')}
                                    {/if}
                                    {if hasGoogle || hasGoogleApps}
                                        ${externalAuth('google', '__MSG__SIGN_IN_WITH_GOOGLE__', 'google-plus')}
                                    {/if}
                                    {if hasCas}
                                        ${externalAuth('cas', null, null, oae.api.config.getValue('oae-authentication', 'cas', 'name'))}
                                    {/if}
                                    {if hasShibboleth}
                                        ${externalAuth('shibboleth', null, null, oae.api.config.getValue('oae-authentication', 'shibboleth', 'name'))}
                                    {/if}
                                </ul>
                            </div>
                        {/if}
                        {if hasLocalAuth}
                            <div id="topnavigation-signin-internal" class="col-xs-12 {if hasLocalAuth && hasExternalAuth} col-sm-6{/if}">
                                <form id="topnavigation-signin-form" role="form">
                                    <div class="form-group">
                                        <label for="topnavigation-signin-username" class="control-label">__MSG__USERNAME__</label>
                                        <input id="topnavigation-signin-username" name="topnavigation-signin-username" type="text" autocapitalize="off" autocorrect="off" class="form-control required" maxlength="255">
                                    </div>
                                    <div class="form-group">
                                        <label for="topnavigation-signin-password" class="control-label">__MSG__PASSWORD__</label>
                                        <input id="topnavigation-signin-password" name="topnavigation-signin-password" type="password" class="form-control required" maxlength="255">
                                    </div>
                                    <div id="topnavigation-login-actions">
                                        <button id="topnavigation-signin-button" class="btn btn-primary pull-right" type="submit">__MSG__SIGN_IN__</button>
                                        <span id="topnavigation-signin-signing-in" class="hide" class="pull-right">__MSG__SIGNING_IN__...</span>
                                        {if oae.api.config.getValue("oae-authentication", "local", "allowAccountCreation")}
                                            <span>__MSG__NO_ACCOUNT_YET__
                                                <button id="topnavigation-signin-signup" type="button" class="btn btn-link oae-trigger-register">__MSG__SIGN_UP__</button>
                                            </span>
                                        {/if}
                                    </div>
                                </form>
                            </div>
                        {/if}
                    </div>
                </div>
            {/if}
        </li>
    </ul>
--></div>

<!--
//////////////////////////////
// LOGGED IN NAVIGATION BAR //
//////////////////////////////
-->

<div id="topnavigation-left-loggedin-template"><!--
    <ul class="list-inline" role="menubar">
        <li>
            <a href="/me" class="btn btn-link" title="__MSG__HOME__" role="menuitem">
                <i class="icon-home"><span class="sr-only">__MSG__HOME__</span></i>
            </a>
        </li>
        <li>
            <button type="button" class="btn btn-link oae-trigger-notifications" title="__MSG__NOTIFICATIONS__" role="menuitem">
                <i class="icon-bullhorn"><span class="sr-only">__MSG__NOTIFICATIONS__</span></i>
                <span id="topnavigation-notification-count" class="badge badge-important">${oae.data.me.notificationsUnread || ''}</span>
            </button>
        </li>
    </ul>
--></div>

<div id="topnavigation-right-loggedin-template"><!--
    <ul class="list-inline" role="menubar">
        <li class="topnavigation-search-button">
            <a href="/search" class="btn btn-link" title="__MSG__SEARCH__" role="menuitem">
                <i class="icon-search"><span class="sr-only">__MSG__SEARCH__</span></i>
            </a>
        </li>
        <li>
            <button type="button" id="topnavigation-signout" class="btn btn-link" title="__MSG__SIGN_OUT__">
                <i class="icon-signout"><span class="sr-only">__MSG__SIGN_OUT__</span></i>
            </button>
        </li>
    </ul>
--></div>

<!--
///////////////////////////////
// PUSH NOTIFICATION SUMMARY //
///////////////////////////////
-->

<div id="topnavigation-push-notification-summary"><!--
    ${renderActivitySummary(activity)}
--></div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="js/topnavigation.js"></script>
