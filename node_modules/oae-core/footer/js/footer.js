/*!
 * Copyright 2012 Sakai Foundation (SF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 *
 *     http://www.osedu.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

define(['jquery', 'oae/api/oae.core'], function($, oae) {
    
    return function(uid, showSettings) {

        var $rootel = $('#' + uid);

        /*!
         * TODO: Move this to a configuration option
         */
        var languages = {
            'en_GB': 'English (United Kingdom)',
            'en_US': 'English (United States)',
            'es_ES': 'Español',
            'fr_FR': 'Français',
            'nl_NL': 'Nederlands',
            'zh_CN': '中文',
            'ru_RU': 'Русский'
        };

        /*!
         * TODO: Move this to a configuration option
         */
        var footerLinks = [{
            'title': '__MSG__COPYRIGHT__',
            'href': 'http://sakaiproject.org/foundation-licenses',
            'newWindow': true
        }, {
            'title': '__MSG__HELP__',
            'href': 'http://sakaiproject.org/node/2307',
            'newWindow': true
        }, {
            'title': '__MSG__ACKNOWLEDGEMENTS__',
            'href': '/acknowledgements'
        }, {
            'title': '__MSG__SUGGEST_AN_IMPROVEMENT__',
            'href': 'http://sakaioae.idea.informer.com/',
            'newWindow': true
        }];

        /**
         * Set the end year of the copyright notice to be the current year
         */
        var setCopyRightYear = function() {
            $('#footer_date_end', $rootel).text(new Date().getFullYear());
        };

        /**
         * Set the current user's language and location. This will only be done
         * for logged in users
         */
        var setLanguageAndLocation = function() {
            // Only set them for logged in users
            if (!oae.data.me.anon) {
                // Set the user's language. Default to the locale name when no translation can be found
                $('#footer_language', $rootel).text(languages[oae.data.me.locale.locale] || oae.data.me.locale.locale);
                // Set the user's location
                $('#footer_location', $rootel).text(oae.data.me.locale.timezone.name);
                // Show the container
                $('#footer_langloc', $rootel).show();
            }
        };

        /**
         * Set the debug info, which will show the current UI and Hilary version for
         * helpdesk purposes
         */
        var setDebugInfo = function() {
            // TODO: Re-implement when debug info can be retrieved
        };

        /**
         * Render the left-hand side footer links, which are configurable in the admin
         * console
         */
        var setFooterLinks = function() {
            // We also need to translate the links as these may contain i18n keys
            $('#footer_links', $rootel).html(oae.api.i18n.translate(oae.api.util.renderTemplate('#footer_links_template', {
                'footerLinks':footerLinks
            }), 'footer'));
        };

        setCopyRightYear();
        setLanguageAndLocation();
        setDebugInfo();
        setFooterLinks();
    };
});
