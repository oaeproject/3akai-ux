<!-- CSS -->
<link rel="stylesheet" type="text/css" href="css/mobileactivity.css"/>

<!-- WIDGET CONTENT CONTAINER -->
<div id="mobileactivity-container">

<ul class="oae-list"><!----></ul>

<div id="mobileactivity-noresults-template"><!--
        <div class="alert">
            <span>No activities</span>
        </div>
    --></div>

<div id="mobileactivity-items-template" class="oae-hidden"><!--
    {macro renderCommentActorThumbnail(mainActor)}
        <a href="#me" title="${entityData.displayName|safeUserInput}">
            <div class="oae-thumbnail {if large} oae-thumbnail-large {/if} icon-oae-${entityData.resourceSubType} icon-oae-${contentType}">
                {if thumbnailUrl}
                    <img src="${thumbnailUrl}" alt="${entityData.displayName|safeUserInput}" />
                {/if}
                {if addVisibilityIcon !== false && entityData.resourceType !== 'user'}
                    <i class="icon-oae-${visibility}"></i>
                {/if}
            </div>
        </a>
    {/macro}

    {macro renderSingleBox(entity)}
        <li>
            <div class="oae-tile">
                <a title="${entity.displayName|safeUserInput}" href="#detail:${entity['oae:id']}">
                    <div class="oae-thumbnail oae-thumbnail-large icon-oae-${entity.objectType}">
                        {if entity.image}
                            <img src="${entity.image.url}" alt="${entity.displayName|safeUserInput}"/>
                        {/if}
                    </div>
                </a>
            </div>
        </li>
    {/macro}

    {macro renderMultipleBox(entities, numMore)}
        {var numMore = numMore < 0 ? 0 : numMore}
        <li>
            <div class="oae-tile activity-content-container multiple">
                {for entity in entities}
                    <div>
                        ${renderThumbnail(entity, false)}
                    </div>
                {/for}
                <div {if !numMore} class="hide"{/if}>
                    {if numMore}
                        <span>__MSG__AND__ ${numMore} __MSG__MORE__...</span>
                    {/if}
                </div>
            </div>
        </li>
    {/macro}

    {macro renderCommentBox(actor, comment)}
        <div class="pull-left activity-entity-image">
            ${renderThumbnail(actor)}
        </div>
        {var created = comment['oae:commentThreadKey'].split('#').pop()}
        <div class="media-body">
            <h4 class="media-heading">
                {if actor.url}
                    <a href="#me" title="${actor.displayName|safeUserInput}__MSG__S_PROFILE__">
                        ${actor.displayName|safeUserInput}
                    </a>
                {else}
                    ${actor.displayName|safeUserInput}
                {/if}
                <span>
                    ${$.timeago(new Date(parseInt(created.substring(0, created.length - 1))))}
                </span>
            </h4>
            ${comment.content|safeUserInput}
        </div>
    {/macro}

    {macro renderCommentActivity(activity)}
        {var mainActor = activity.actor}
        {if activity.actor['oae:collection']}
            {var mainActor = activity.actor['oae:collection'][0]}
        {/if}

        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(mainActor)}
                </div>
                <div class="activity-entity-name oae-threedots oae-bold">
                    <span class="activity-title">
                        {if mainActor.url}
                            <a href="#me" title="${mainActor.displayName|safeUserInput}__MSG__S_PROFILE__">${mainActor.displayName|safeUserInput}</a>
                        {else}
                            ${mainActor.displayName|safeUserInput}
                        {/if}
                        {if activity.actor['oae:collection']}
                            <span> and ${activity.actor['oae:collection'].length - 1} {if (activity.actor['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if} __MSG__COMMENTED_ON__</span> <a href="#detail:${activity.target['oae:id']}" title="${activity.target.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.target.displayName|safeUserInput}</a>
                        {else}
                            <span>__MSG__COMMENTED_ON__</span> <a href="#detail:${activity.target['oae:id']}" title="${activity.target.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.target.displayName|safeUserInput}</a>
                        {/if}
                    </span>
                </div>
                ${renderLargeContentPreview(activity.actor, activity.target, activity.object, true)}
            </div>
        </div>
    {/macro}

    {macro renderShareActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.object)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    <span class="activity-title">
                        {if activity.object['oae:collection']}
                            {if activity.actor.url}
                                <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                            {else}
                                ${activity.actor.displayName|safeUserInput}
                            {/if}
                            <span> shared the PDF</span> <a href="#detail:${activity.object['oae:collection'][0].url}" title="${activity.object['oae:collection'][0].displayName|safeUserInput}">${activity.object['oae:collection'][0].displayName|safeUserInput}</a> and ${activity.object['oae:collection'].length - 1} {if (activity.object['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if}
                        {else}
                            {if activity.actor.url}
                                <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                            {else}
                                ${activity.actor.displayName|safeUserInput}
                            {/if}
                            <span> shared the PDF</span> <a href="#detail:${activity.target['oae:id']}" title="${activity.object.displayName|safeUserInput}">${activity.object.displayName|safeUserInput}</a>
                        {/if}
                    </span>
                </div>
                {if activity.target['oae:collection']}
                    <div class="activity-timeago">__MSG__WITH__
                        {if activity.target['oae:collection'][0].url}
                            <a href="#detail:${activity.target['oae:collection'][0].url}" title="${activity.target['oae:collection'][0].displayName|safeUserInput}__MSG__S_PROFILE__">${activity.target['oae:collection'][0].displayName|safeUserInput}</a>
                        {else}
                            ${activity.target['oae:collection'][0].displayName|safeUserInput}
                        {/if}
                        and ${activity.target['oae:collection'].length - 1} {if (activity.target['oae:collection'].length - 1) === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if} ${$.timeago(new Date(activity.published))}</div>
                {else}
                    <div class="activity-timeago">__MSG__WITH__
                    {if activity.target.url}
                        <a href="#detail:${activity.target['oae:id']}" title="${activity.target.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.target.displayName|safeUserInput}</a>
                    {else}
                        ${activity.target.displayName|safeUserInput}
                    {/if}
                    ${$.timeago(new Date(activity.published))}</div>
                {/if}
            </div>

            <div class="activity-content-container">
                {if activity.target['oae:collection']}
                    <ul class="oae-list oae-list-grid clearfix">
                        {if activity.target['oae:collection'].length > 3}
                            ${renderSingleBox(activity.target['oae:collection'][0])}
                            ${renderSingleBox(activity.target['oae:collection'][1])}
                            ${renderMultipleBox(activity.target['oae:collection'].slice(2, 18), activity.target['oae:collection'].length - 18)}
                        {else}
                            {for t in activity.target['oae:collection']}
                                ${renderSingleBox(t)}
                            {/for}
                        {/if}
                    </ul>
                {else}
                    <ul class="oae-list oae-list-grid clearfix">
                        ${renderSingleBox(activity.target)}
                    </ul>
                {/if}
            </div>
        </div>
    {/macro}

    {macro renderCreateContentActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor, false, false)}
                </div>
                <div class="activity-entity-name oae-threedots oae-bold">
                    <span class="activity-title">
                        {if activity.actor.url}
                            <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                        {else}
                            ${activity.actor.displayName|safeUserInput}
                        {/if}
                        <span>__MSG__CREATED__</span> <a href="#detail:${activity.object['oae:id']}" title="${activity.object.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.object.displayName|safeUserInput}</a>
                        {if activity.object['oae:collection']}
                            ${activity.object['oae:collection'].length} __MSG__CONTENT_ITEMS__
                        {/if}
                    </span>
                </div>
            </div>

            {if activity.object.objectType === 'collection'}
                {var entities = activity.object['oae:collection']}
                {var total = entities.length}
                {if total <= 3}
                    {if total == 1}
                        <ul class="oae-list oae-list-grid clearfix single">
                    {elseif total == 2}
                        <ul class="oae-list oae-list-grid clearfix double">
                    {else if total == 3}
                        <ul class="oae-list oae-list-grid clearfix triple">
                    {/if}
                        {for entity in entities}
                            ${renderSingleBox(entity)}
                        {/for}
                        </ul>
                {else}
                    {var largeEntities = entities.slice(0, 2)}
                    <ul class="oae-list oae-list-grid clearfix">
                        {for entity in largeEntities}
                            ${renderSingleBox(entity)}
                        {/for}
                        ${renderMultipleBox(entities.slice(2, 18), total - 18)}
                    </ul>
                {/if}
            {else}
                ${renderLargeContentPreview(activity.actor, activity.object, false, false)}
            {/if}
            <div class="oae-mobile-tile-bottom">
                {if activity.hasOwnProperty('target') && activity['object'].hasOwnProperty('oae:collection')}
                    <span class="comments"><span><span>${activity['object']['oae:collection'].length}</span> __MSG__COMMENTS__</span></span>
                {/if}
                <span class="timeago"><span>${$.timeago(new Date(activity.published))}</span></span>
            </div>
        </div>
    {/macro}

    {macro renderLargeContentPreview(actor, content, comments, withbottom)}
        {var signatureQueryString = (content.image) ? content.image.url.split('?')[1] : null}
        {if content['oae:previews'] && content['oae:mimeType'] === 'application/pdf'}
            ${content.image.url = '/api/content/' + content['oae:id'] + '/previews/page.1.normal.png?' + signatureQueryString|eat}
        {elseif content['oae:previews']}
            ${content.image.url = '/api/content/' + content['oae:id'] + '/previews/medium.png?' + signatureQueryString|eat}
        {/if}

        <ul class="oae-list oae-list-grid clearfix">
            <li class="oae-tile-large">
                <div class="oae-tile">
                    <a title="${content.displayName|safeUserInput}" href="#detail:${content['oae:id']}">
                        <div class="oae-thumbnail oae-thumbnail-large icon-oae-${content.objectType} icon-oae-${content['oae:contentType']}">
                            {if content.image}
                                <span style="background-image: url('${content.image.url}')"></span>
                            {/if}
                        </div>
                    </a>
                </div>
            </li>
        </ul>
        {if withbottom}
        <div class="oae-mobile-tile-bottom">
            {if activity.hasOwnProperty('target') && activity['object'].hasOwnProperty('oae:collection')}
                <span class="comments"><span><span>${activity['object']['oae:collection'].length}</span> __MSG__COMMENTS__</span></span>
            {/if}
            <span class="timeago"><span>${$.timeago(new Date(activity.published))}</span></span>
        </div>
        {/if}

        <div class="activity-comment-container">
            {if comments && comments['oae:collection']}
                <ul class="media-list">
                    {var objComment = comments['oae:collection'][0]}
                    <li class="media">
                        ${renderCommentBox(objComment['author'], objComment)}
                    </li>
                </ul>
                <a href="#detail:${content['oae:id']}" title="${content.displayName|safeUserInput}" class="oae-bold activity-read-more text-center">__MSG__SHOW_MORE__...</a>
            {elseif comments}
                <ul class="media-list">
                    <li class="media">
                        ${renderCommentBox(comments.author, comments)}
                    </li>
                </ul>
                <a href="#detail:${content['oae:id']}" title="${content.displayName|safeUserInput}" class="oae-bold activity-read-more text-center">__MSG__SHOW_MORE__...</a>
            {/if}
        </div>
    {/macro}

    {macro renderVisibilityUpdateActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    <span class="activity-title">
                        {if activity.actor.url}
                            <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                        {else}
                            ${activity.actor.displayName|safeUserInput}
                        {/if}
                        <span>
                            {if activity['oae:activityType'] === 'group-update'}
                                __MSG__UPDATED_GROUP__
                            {elseif activity['oae:activityType'] === 'content-update-visibility'}
                                __MSG__UPDATED_CONTENT_VISIBILITY__
                            {elseif activity['oae:activityType'] === 'group-update-visibility'}
                                __MSG__UPDATED_GROUP_VISIBILITY__
                            {/if}
                        </span>
                    </span>
                </div>
            </div>
            <ul class="oae-list oae-list-grid clearfix">
                ${renderSingleBox(activity.object)}
            </ul>
            <div class="oae-mobile-tile-bottom">
                {if activity.hasOwnProperty('target') && activity['object'].hasOwnProperty('oae:collection')}
                    <span class="comments"><span><span>${activity['object']['oae:collection'].length}</span> __MSG__COMMENTS__</span></span>
                {/if}
                <span class="timeago"><span>${$.timeago(new Date(activity.published))}</span></span>
            </div>
        </div>
    {/macro}

    {macro renderCreateGroupActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.object)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    <span class="activity-title">
                        {if activity.actor.url}
                            <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                        {else}
                            ${activity.actor.displayName|safeUserInput}
                        {/if}
                        <span>__MSG__CREATED_THE_GROUP__</span> <a href="#detail:${activity.object['oae:id']}" title="${activity.object.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.object.displayName|safeUserInput}</a>
                    </span>
                </div>
            </div>

            <div class="activity-content-container">
                <ul class="oae-list oae-list-grid clearfix">
                    ${renderSingleBox(activity.object)}
                </ul>
            </div>
            <div class="oae-mobile-tile-bottom">
                {if activity.hasOwnProperty('target') && activity['object'].hasOwnProperty('oae:collection')}
                    <span class="comments"><span><span>${activity['object']['oae:collection'].length}</span> __MSG__COMMENTS__</span></span>
                {/if}
                <span class="timeago"><span>${$.timeago(new Date(activity.published))}</span></span>
            </div>
        </div>
    {/macro}

    {macro renderAddMemberActivity(activity)}
        <div class="activity-item-container well">
            <div class="activity-entity-container">
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.actor)}
                </div>
                <div class="pull-left activity-entity-image">
                    ${renderThumbnail(activity.target)}
                </div>

                <div class="activity-entity-name oae-threedots oae-bold">
                    {if activity.actor.url}
                        <a href="#me" title="${activity.actor.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.actor.displayName|safeUserInput}</a>
                    {else}
                        ${activity.actor.displayName|safeUserInput}
                    {/if}
                        <span>__MSG__ADDED__</span>
                    {if activity.object['oae:collection']}
                        {if activity.object['oae:collection'][0].url}
                            <a href="#detail:${activity.object['oae:collection'][0].url}" title="${activity.object['oae:collection'][0].displayName|safeUserInput}__MSG__S_PROFILE__">${activity.object['oae:collection'][0].displayName|safeUserInput}</a>
                        {else}
                            ${activity.object['oae:collection'][0].displayName|safeUserInput}
                        {/if}
                        <span>__MSG__AND_LOWERCASE__ ${activity.object['oae:collection'].length - 1} {if activity.object['oae:collection'].length === 1} __MSG__OTHER__{else} __MSG__OTHERS__{/if}</span>
                    {else}
                        {if activity.object.url}
                            <a href="#detail:${activity.object.url}" title="${activity.object.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.object.displayName|safeUserInput}</a>
                        {else}
                            ${activity.object.displayName|safeUserInput}
                        {/if}
                    {/if}
                    <span>__MSG__TO_THE_GROUP__</span> <a href="#detail:${activity.target['oae:id']}" title="${activity.target.displayName|safeUserInput}__MSG__S_PROFILE__">${activity.target.displayName|safeUserInput}</a>
                </div>
            </div>

            <div class="activity-content-container">
                <ul class="oae-list oae-list-grid clearfix">
                    {if activity.object['oae:collection']}
                        {if activity.object['oae:collection'].length > 3}
                            ${renderSingleBox(activity.object['oae:collection'][0])}
                            ${renderSingleBox(activity.object['oae:collection'][1])}
                            ${renderMultipleBox(activity.object['oae:collection'].slice(2, 22), activity.object['oae:collection'].length - 21)}
                        {else}
                            {for t in activity.object['oae:collection']}
                                ${renderSingleBox(t)}
                            {/for}
                        {/if}
                    {else}
                        ${renderSingleBox(activity.object)}
                    {/if}
                </ul>
            </div>
        </div>
    {/macro}

    {for activity in results}
        <li data-key="${activity['oae:activityId']}">
            {if activity['oae:activityType'] === 'content-comment'}
                ${renderCommentActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-share'}
                ${renderShareActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-create'}
                ${renderCreateContentActivity(activity)}
            {elseif activity['oae:activityType'] === 'content-update-visibility' ||
                    activity['oae:activityType'] === 'group-update-visibility' ||
                    activity['oae:activityType'] === 'group-update'}
                ${renderVisibilityUpdateActivity(activity)}
            {elseif activity['oae:activityType'] === 'group-create'}
                ${renderCreateGroupActivity(activity)}
            {elseif activity['oae:activityType'] === 'group-add-member'}
                ${renderAddMemberActivity(activity)}
            {/if}
        </li>
    {/for}
    --></div>

</div>

<!-- JAVASCRIPT -->
<script type="text/javascript" src="js/mobileactivity.js"></script>

<!--
{for c in comments['oae:collection']}
    <li class="media {if c['oae:replyTo']} activity-reply{/if}">
        {var commentActor = actor}
        {if actor['oae:collection']}
            {for a in actor['oae:collection']}
                {if a['oae:id'] === c.author['oae:id']}
                    {var commentActor = a}
                {/if}
            {/for}
        {/if}
        ${renderCommentBox(c.author, c)}
    </li>
{/for}
-->
